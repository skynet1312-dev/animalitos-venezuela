import React, { useState, useEffect } from 'react';
import { Shuffle, TrendingUp, BarChart3, Calendar, Clock, Trophy, Plus, Save, Trash2, Sparkles, Target, History } from 'lucide-react';

const animalitos = [
  { numero: '00', nombre: 'Delf√≠n', color: 'bg-blue-500' },
  { numero: '01', nombre: 'Carnero', color: 'bg-amber-600' },
  { numero: '02', nombre: 'Toro', color: 'bg-red-700' },
  { numero: '03', nombre: 'Ciempi√©s', color: 'bg-gray-600' },
  { numero: '04', nombre: 'Alacr√°n', color: 'bg-yellow-600' },
  { numero: '05', nombre: 'Le√≥n', color: 'bg-orange-500' },
  { numero: '06', nombre: 'Rana', color: 'bg-green-600' },
  { numero: '07', nombre: 'Perico', color: 'bg-green-500' },
  { numero: '08', nombre: 'Rat√≥n', color: 'bg-gray-500' },
  { numero: '09', nombre: '√Åguila', color: 'bg-yellow-700' },
  { numero: '10', nombre: 'Tigre', color: 'bg-orange-600' },
  { numero: '11', nombre: 'Gato', color: 'bg-gray-700' },
  { numero: '12', nombre: 'Caballo', color: 'bg-amber-700' },
  { numero: '13', nombre: 'Mono', color: 'bg-amber-500' },
  { numero: '14', nombre: 'Paloma', color: 'bg-gray-400' },
  { numero: '15', nombre: 'Zorro', color: 'bg-orange-700' },
  { numero: '16', nombre: 'Oso', color: 'bg-amber-800' },
  { numero: '17', nombre: 'Pavo', color: 'bg-red-600' },
  { numero: '18', nombre: 'Burro', color: 'bg-gray-600' },
  { numero: '19', nombre: 'Chivo', color: 'bg-amber-600' },
  { numero: '20', nombre: 'Cochino', color: 'bg-pink-400' },
  { numero: '21', nombre: 'Gallo', color: 'bg-red-500' },
  { numero: '22', nombre: 'Camello', color: 'bg-yellow-600' },
  { numero: '23', nombre: 'Cebra', color: 'bg-gray-800' },
  { numero: '24', nombre: 'Iguana', color: 'bg-green-700' },
  { numero: '25', nombre: 'Gallina', color: 'bg-red-400' },
  { numero: '26', nombre: 'Vaca', color: 'bg-amber-500' },
  { numero: '27', nombre: 'Perro', color: 'bg-amber-700' },
  { numero: '28', nombre: 'Zamuro', color: 'bg-gray-900' },
  { numero: '29', nombre: 'Elefante', color: 'bg-gray-600' },
  { numero: '30', nombre: 'Caim√°n', color: 'bg-green-800' },
  { numero: '31', nombre: 'Lapa', color: 'bg-blue-600' },
  { numero: '32', nombre: 'Ardilla', color: 'bg-orange-400' },
  { numero: '33', nombre: 'Pescado', color: 'bg-blue-400' },
  { numero: '34', nombre: 'Venado', color: 'bg-amber-600' },
  { numero: '35', nombre: 'Jirafa', color: 'bg-yellow-500' },
  { numero: '36', nombre: 'Culebra', color: 'bg-green-600' }
];

const horariosLottoactivo = [
  '08:00 AM', '09:00 AM', '10:00 AM', '11:00 AM', '12:00 PM',
  '01:00 PM', '02:00 PM', '03:00 PM', '04:00 PM', '05:00 PM', '06:00 PM', '07:00 PM'
];

const horariosGranjita = [
  '08:00 AM', '09:00 AM', '10:00 AM', '11:00 AM', '12:00 PM',
  '01:00 PM', '02:00 PM', '03:00 PM', '04:00 PM', '05:00 PM', '06:00 PM', '07:00 PM'
];

export default function PronosticosAnimalitos() {
  const [cantidadJugar, setCantidadJugar] = useState(5);
  const [pronosticos, setPronosticos] = useState([]);
  const [sorteo, setSorteo] = useState('lottoactivo');
  const [vistaActual, setVistaActual] = useState('pronosticos');
  const [resultados, setResultados] = useState([]);
  const [nuevoResultado, setNuevoResultado] = useState({
    fecha: new Date().toISOString().split('T')[0],
    sorteo: 'lottoactivo',
    horario: '08:00 AM',
    numero: '00'
  });
  const [periodoEstadistica, setPeriodoEstadistica] = useState('mes');
  const [fechaBusqueda, setFechaBusqueda] = useState('');

  useEffect(() => {
    cargarResultados();
  }, []);

  const cargarResultados = async () => {
    try {
      const data = await window.storage.get('resultados-animalitos');
      if (data) {
        setResultados(JSON.parse(data.value));
      }
    } catch (error) {
      console.log('No hay resultados guardados a√∫n');
    }
  };

  const guardarResultados = async (nuevosResultados) => {
    try {
      await window.storage.set('resultados-animalitos', JSON.stringify(nuevosResultados));
      setResultados(nuevosResultados);
    } catch (error) {
      console.error('Error al guardar:', error);
    }
  };

  const agregarResultado = () => {
    const resultado = {
      ...nuevoResultado,
      id: Date.now(),
      timestamp: new Date().toISOString()
    };
    const nuevosResultados = [...resultados, resultado];
    guardarResultados(nuevosResultados);
    
    setNuevoResultado({
      ...nuevoResultado,
      numero: '00'
    });
  };

  const eliminarResultado = (id) => {
    const nuevosResultados = resultados.filter(r => r.id !== id);
    guardarResultados(nuevosResultados);
  };

  const generarPronosticos = () => {
    const shuffled = [...animalitos].sort(() => Math.random() - 0.5);
    setPronosticos(shuffled.slice(0, cantidadJugar));
  };

  const generarPrediccion = () => {
    const stats = calcularEstadisticas();
    
    // Obtener los √∫ltimos 20 resultados para an√°lisis de patrones
    const ultimosResultados = obtenerResultadosFiltrados().slice(-20);
    
    // Calcular pesos basados en m√∫ltiples factores
    const predicciones = stats.map(animal => {
      let peso = 0;
      
      // Factor 1: Frecuencia hist√≥rica (40% del peso)
      peso += parseFloat(animal.porcentaje) * 0.4;
      
      // Factor 2: Tendencia reciente - √∫ltimos 10 sorteos (30% del peso)
      const aparicionesRecientes = ultimosResultados.slice(-10).filter(r => r.numero === animal.numero).length;
      peso += (aparicionesRecientes / 10) * 100 * 0.3;
      
      // Factor 3: Variaci√≥n y "deuda estad√≠stica" (30% del peso)
      const promedioEsperado = 100 / 37; // 2.70%
      const diferencia = promedioEsperado - parseFloat(animal.porcentaje);
      if (diferencia > 0) {
        // Si ha salido menos de lo esperado, aumenta su probabilidad
        peso += Math.abs(diferencia) * 2 * 0.3;
      }
      
      return {
        ...animal,
        pesoPrediccion: peso,
        aparicionesRecientes
      };
    });
    
    // Ordenar por peso de predicci√≥n
    return predicciones.sort((a, b) => b.pesoPrediccion - a.pesoPrediccion);
  };

  const obtenerResultadosFiltrados = () => {
    const ahora = new Date();
    const hoy = new Date(ahora.getFullYear(), ahora.getMonth(), ahora.getDate());
    
    return resultados.filter(r => {
      const fechaResultado = new Date(r.fecha);
      
      if (periodoEstadistica === 'dia') {
        return fechaResultado >= hoy;
      } else if (periodoEstadistica === 'semana') {
        const unaSemanaAtras = new Date(hoy);
        unaSemanaAtras.setDate(hoy.getDate() - 7);
        return fechaResultado >= unaSemanaAtras;
      } else {
        const unMesAtras = new Date(hoy);
        unMesAtras.setMonth(hoy.getMonth() - 1);
        return fechaResultado >= unMesAtras;
      }
    });
  };

  const calcularEstadisticas = () => {
    const filtrados = obtenerResultadosFiltrados();
    const stats = {};
    
    animalitos.forEach(animal => {
      stats[animal.numero] = {
        ...animal,
        veces: 0,
        porcentaje: 0
      };
    });

    filtrados.forEach(resultado => {
      if (stats[resultado.numero]) {
        stats[resultado.numero].veces++;
      }
    });

    const total = filtrados.length;
    Object.keys(stats).forEach(key => {
      stats[key].porcentaje = total > 0 ? ((stats[key].veces / total) * 100).toFixed(2) : 0;
    });

    return Object.values(stats);
  };

  const getTopAnimalitos = () => {
    return calcularEstadisticas()
      .sort((a, b) => b.veces - a.veces)
      .slice(0, 10);
  };

  const getMenosFrequentes = () => {
    return calcularEstadisticas()
      .sort((a, b) => a.veces - b.veces)
      .slice(0, 10);
  };

  const obtenerResultadosHoy = () => {
    const hoy = new Date().toISOString().split('T')[0];
    return resultados.filter(r => r.fecha === hoy && r.sorteo === sorteo);
  };

  const getPeriodoTexto = () => {
    if (periodoEstadistica === 'dia') return 'Hoy';
    if (periodoEstadistica === 'semana') return '√öltima Semana';
    return '√öltimo Mes';
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-green-600 to-blue-700 p-4">
      <div className="max-w-4xl mx-auto">
        <div className="bg-white rounded-2xl shadow-2xl p-6 mb-6">
          <div className="text-center mb-6">
            <h1 className="text-3xl font-bold text-gray-800 mb-2 flex items-center justify-center gap-2">
              <TrendingUp className="text-green-600" size={32} />
              Pron√≥sticos Animalitos
            </h1>
            <p className="text-gray-600">Registra resultados y analiza estad√≠sticas</p>
          </div>

          <div className="grid grid-cols-6 gap-2 mb-6">
            <button
              onClick={() => setVistaActual('pronosticos')}
              className={`py-3 px-2 rounded-lg font-semibold transition-all flex items-center justify-center gap-1 text-xs ${
                vistaActual === 'pronosticos'
                  ? 'bg-green-600 text-white shadow-lg'
                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
              }`}
            >
              <Shuffle size={16} />
              Pron√≥sticos
            </button>
            <button
              onClick={() => setVistaActual('recomendacion')}
              className={`py-3 px-2 rounded-lg font-semibold transition-all flex items-center justify-center gap-1 text-xs ${
                vistaActual === 'recomendacion'
                  ? 'bg-indigo-600 text-white shadow-lg'
                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
              }`}
            >
              <TrendingUp size={16} />
              IA
            </button>
            <button
              onClick={() => setVistaActual('agregar')}
              className={`py-3 px-2 rounded-lg font-semibold transition-all flex items-center justify-center gap-1 text-xs ${
                vistaActual === 'agregar'
                  ? 'bg-purple-600 text-white shadow-lg'
                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
              }`}
            >
              <Plus size={16} />
              Agregar
            </button>
            <button
              onClick={() => setVistaActual('historico')}
              className={`py-3 px-2 rounded-lg font-semibold transition-all flex items-center justify-center gap-1 text-xs ${
                vistaActual === 'historico'
                  ? 'bg-teal-600 text-white shadow-lg'
                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
              }`}
            >
              <History size={16} />
              Hist√≥rico
            </button>
            <button
              onClick={() => setVistaActual('resultados')}
              className={`py-3 px-2 rounded-lg font-semibold transition-all flex items-center justify-center gap-1 text-xs ${
                vistaActual === 'resultados'
                  ? 'bg-orange-600 text-white shadow-lg'
                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
              }`}
            >
              <Trophy size={16} />
              Hoy
            </button>
            <button
              onClick={() => setVistaActual('estadisticas')}
              className={`py-3 px-2 rounded-lg font-semibold transition-all flex items-center justify-center gap-1 text-xs ${
                vistaActual === 'estadisticas'
                  ? 'bg-blue-600 text-white shadow-lg'
                  : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
              }`}
            >
              <BarChart3 size={16} />
              Estad√≠sticas
            </button>
          </div>

          {vistaActual === 'pronosticos' ? (
            <>
              <div className="space-y-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    Selecciona el sorteo:
                  </label>
                  <div className="grid grid-cols-2 gap-3">
                    <button
                      onClick={() => setSorteo('lottoactivo')}
                      className={`p-3 rounded-lg font-semibold transition-all ${
                        sorteo === 'lottoactivo'
                          ? 'bg-green-600 text-white shadow-lg'
                          : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                      }`}
                    >
                      Lottoactivo
                    </button>
                    <button
                      onClick={() => setSorteo('granjita')}
                      className={`p-3 rounded-lg font-semibold transition-all ${
                        sorteo === 'granjita'
                          ? 'bg-blue-600 text-white shadow-lg'
                          : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                      }`}
                    >
                      La Granjita
                    </button>
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    ¬øCu√°ntos animalitos quieres jugar? ({cantidadJugar})
                  </label>
                  <input
                    type="range"
                    min="1"
                    max="10"
                    value={cantidadJugar}
                    onChange={(e) => setCantidadJugar(parseInt(e.target.value))}
                    className="w-full h-2 bg-gray-300 rounded-lg cursor-pointer"
                  />
                </div>

                <button
                  onClick={generarPronosticos}
                  className="w-full bg-gradient-to-r from-green-500 to-blue-600 text-white py-4 rounded-xl font-bold text-lg hover:from-green-600 hover:to-blue-700 transition-all shadow-lg flex items-center justify-center gap-2"
                >
                  <Shuffle size={24} />
                  Generar Pron√≥sticos
                </button>
              </div>

              {pronosticos.length > 0 && (
                <div className="mt-8">
                  <h2 className="text-xl font-bold text-gray-800 mb-4 text-center">
                    Tus Pron√≥sticos para {sorteo === 'lottoactivo' ? 'Lottoactivo' : 'La Granjita'}
                  </h2>
                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    {pronosticos.map((animal, index) => (
                      <div
                        key={index}
                        className="bg-gradient-to-br from-white to-gray-50 rounded-xl p-4 shadow-md border-2 border-gray-200"
                      >
                        <div className="flex items-center gap-4">
                          <div className={`${animal.color} w-16 h-16 rounded-full flex items-center justify-center text-white font-bold text-2xl shadow-lg`}>
                            {animal.numero}
                          </div>
                          <div className="flex-1">
                            <p className="text-sm text-gray-500 font-medium">Animalito #{index + 1}</p>
                            <p className="text-xl font-bold text-gray-800">{animal.nombre}</p>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </>
          ) : vistaActual === 'recomendacion' ? (
            <div className="space-y-6">
              <div className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl p-5 border-2 border-indigo-200">
                <div className="flex items-center gap-2 mb-3">
                  <TrendingUp className="text-indigo-600" size={24} />
                  <h3 className="text-lg font-bold text-gray-800">Recomendaciones Basadas en Probabilidades</h3>
                </div>
                <p className="text-sm text-gray-600 text-center">
                  An√°lisis basado en las estad√≠sticas del {getPeriodoTexto().toLowerCase()}
                </p>
              </div>

              <div className="flex justify-center gap-3 mb-4">
                <button
                  onClick={() => setPeriodoEstadistica('dia')}
                  className={`px-4 py-2 rounded-lg font-semibold text-sm transition-all ${
                    periodoEstadistica === 'dia'
                      ? 'bg-indigo-600 text-white shadow-lg'
                      : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                  }`}
                >
                  Hoy
                </button>
                <button
                  onClick={() => setPeriodoEstadistica('semana')}
                  className={`px-4 py-2 rounded-lg font-semibold text-sm transition-all ${
                    periodoEstadistica === 'semana'
                      ? 'bg-indigo-600 text-white shadow-lg'
                      : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                  }`}
                >
                  Semana
                </button>
                <button
                  onClick={() => setPeriodoEstadistica('mes')}
                  className={`px-4 py-2 rounded-lg font-semibold text-sm transition-all ${
                    periodoEstadistica === 'mes'
                      ? 'bg-indigo-600 text-white shadow-lg'
                      : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                  }`}
                >
                  Mes
                </button>
              </div>

              {obtenerResultadosFiltrados().length > 0 ? (
                <>
                  <div className="bg-gradient-to-r from-purple-500 to-pink-600 rounded-xl p-6 text-white shadow-lg mb-6">
                    <h3 className="text-xl font-bold mb-3 flex items-center gap-2">
                      <Sparkles size={28} />
                      üîÆ Predicci√≥n del Pr√≥ximo Sorteo
                    </h3>
                    <p className="text-sm opacity-90 mb-4">
                      Basado en an√°lisis de frecuencias, tendencias recientes y probabilidad estad√≠stica
                    </p>
                    
                    {(() => {
                      const predicciones = generarPrediccion();
                      const top3 = predicciones.slice(0, 3);
                      
                      return (
                        <div className="space-y-3">
                          {top3.map((animal, index) => (
                            <div key={animal.numero} className="bg-white/15 backdrop-blur rounded-xl p-4 border-2 border-white/30">
                              <div className="flex items-center gap-4">
                                <div className="relative">
                                  {index === 0 && (
                                    <div className="absolute -top-2 -right-2 bg-yellow-400 text-purple-900 rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold">
                                      ‚≠ê
                                    </div>
                                  )}
                                  <div className="bg-white/20 rounded-full w-14 h-14 flex flex-col items-center justify-center font-bold">
                                    <span className="text-xs opacity-75">#{index + 1}</span>
                                    <span className="text-lg">{index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : 'ü•â'}</span>
                                  </div>
                                </div>
                                <div className={`${animal.color} w-16 h-16 rounded-full flex items-center justify-center text-white font-bold text-2xl shadow-xl border-4 border-white/30`}>
                                  {animal.numero}
                                </div>
                                <div className="flex-1">
                                  <p className="text-xl font-bold">{animal.nombre}</p>
                                  <p className="text-sm opacity-90">
                                    Hist√≥rico: {animal.veces} veces ({animal.porcentaje}%)
                                  </p>
                                  <p className="text-xs opacity-75">
                                    {animal.aparicionesRecientes > 0 
                                      ? `üî• ${animal.aparicionesRecientes} veces en √∫ltimos 10 sorteos`
                                      : '‚ùÑÔ∏è No ha salido recientemente'}
                                  </p>
                                </div>
                                <div className="text-right">
                                  <div className="bg-white/25 rounded-lg px-3 py-2">
                                    <p className="text-2xl font-bold">{animal.pesoPrediccion.toFixed(1)}</p>
                                    <p className="text-xs opacity-75">score IA</p>
                                  </div>
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>
                      );
                    })()}
                    
                    <div className="mt-4 bg-white/10 rounded-lg p-3 text-sm">
                      <p className="flex items-center gap-2">
                        <Target size={16} />
                        <strong>Algoritmo de Predicci√≥n:</strong>
                      </p>
                      <p className="text-xs opacity-90 mt-1">
                        40% Frecuencia hist√≥rica + 30% Tendencia reciente + 30% Compensaci√≥n estad√≠stica
                      </p>
                    </div>
                  </div>

                  <div className="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 text-white shadow-lg">
                    <h3 className="text-lg font-bold mb-4 flex items-center gap-2">
                      <Trophy size={24} />
                      Top 5 Recomendados - Mayor Probabilidad
                    </h3>
                    <div className="grid grid-cols-1 gap-3">
                      {getTopAnimalitos().slice(0, 5).map((animal, index) => (
                        <div key={animal.numero} className="bg-white/10 backdrop-blur rounded-lg p-4 border-2 border-white/20">
                          <div className="flex items-center gap-4">
                            <div className="bg-white/20 rounded-full w-12 h-12 flex items-center justify-center font-bold text-2xl">
                              #{index + 1}
                            </div>
                            <div className={`${animal.color} w-14 h-14 rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg`}>
                              {animal.numero}
                            </div>
                            <div className="flex-1">
                              <p className="text-xl font-bold">{animal.nombre}</p>
                              <p className="text-sm opacity-90">Sali√≥ {animal.veces} veces</p>
                            </div>
                            <div className="text-right">
                              <p className="text-3xl font-bold">{animal.porcentaje}%</p>
                              <p className="text-xs opacity-75">probabilidad</p>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  <div className="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-xl p-5 border-2 border-yellow-200">
                    <h3 className="text-lg font-bold text-gray-800 mb-3">üí° An√°lisis Inteligente</h3>
                    <div className="space-y-2 text-sm text-gray-700">
                      {(() => {
                        const top = getTopAnimalitos()[0];
                        const total = obtenerResultadosFiltrados().length;
                        const promedio = (total / 37).toFixed(1);
                        return (
                          <>
                            <p>
                              <strong>L√≠der absoluto:</strong> El <span className="font-bold text-indigo-600">{top.nombre} ({top.numero})</span> ha 
                              salido <span className="font-bold">{top.veces} veces</span> con una probabilidad del <span className="font-bold">{top.porcentaje}%</span>.
                            </p>
                            <p>
                              <strong>Promedio esperado:</strong> Cada animalito deber√≠a salir aproximadamente {promedio} veces 
                              en {total} sorteos ({(100/37).toFixed(2)}% de probabilidad).
                            </p>
                            <p>
                              <strong>Recomendaci√≥n:</strong> Los animalitos del Top 5 han mostrado mayor frecuencia en el per√≠odo analizado.
                              Sin embargo, recuerda que cada sorteo es independiente y los resultados pasados no garantizan resultados futuros.
                            </p>
                          </>
                        );
                      })()}
                    </div>
                  </div>

                  <div className="bg-gradient-to-br from-red-50 to-pink-50 rounded-xl p-5 border-2 border-red-200">
                    <h3 className="text-lg font-bold text-gray-800 mb-3">‚ö†Ô∏è Menos Probables (Menor Frecuencia)</h3>
                    <div className="grid grid-cols-2 gap-2">
                      {getMenosFrequentes().slice(0, 5).map((animal) => (
                        <div key={animal.numero} className="bg-white rounded-lg p-3 shadow-sm border border-red-200 flex items-center gap-2">
                          <div className={`${animal.color} w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm`}>
                            {animal.numero}
                          </div>
                          <div className="flex-1">
                            <p className="font-semibold text-gray-800 text-sm">{animal.nombre}</p>
                            <p className="text-xs text-gray-600">{animal.porcentaje}% ({animal.veces}x)</p>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                </>
              ) : (
                <div className="text-center py-12 text-gray-500">
                  <BarChart3 size={64} className="mx-auto mb-4 opacity-30" />
                  <p className="text-lg font-semibold mb-2">No hay datos suficientes</p>
                  <p className="text-sm">Comienza agregando resultados en la secci√≥n "Agregar" para generar recomendaciones inteligentes.</p>
                </div>
              )}
            </div>
          ) : vistaActual === 'agregar' ? (
            <div className="space-y-4">
              <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                <Plus className="text-purple-600" />
                Agregar Resultado Manual
              </h2>

              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Fecha</label>
                <input
                  type="date"
                  value={nuevoResultado.fecha}
                  onChange={(e) => setNuevoResultado({...nuevoResultado, fecha: e.target.value})}
                  className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 outline-none"
                />
              </div>

              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Sorteo</label>
                <select
                  value={nuevoResultado.sorteo}
                  onChange={(e) => setNuevoResultado({...nuevoResultado, sorteo: e.target.value, horario: e.target.value === 'lottoactivo' ? '08:00 AM' : '09:30 AM'})}
                  className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 outline-none"
                >
                  <option value="lottoactivo">Lottoactivo</option>
                  <option value="granjita">La Granjita</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Horario</label>
                <select
                  value={nuevoResultado.horario}
                  onChange={(e) => setNuevoResultado({...nuevoResultado, horario: e.target.value})}
                  className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 outline-none"
                >
                  {(nuevoResultado.sorteo === 'lottoactivo' ? horariosLottoactivo : horariosGranjita).map(h => (
                    <option key={h} value={h}>{h}</option>
                  ))}
                </select>
              </div>

              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Animalito</label>
                <select
                  value={nuevoResultado.numero}
                  onChange={(e) => setNuevoResultado({...nuevoResultado, numero: e.target.value})}
                  className="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 outline-none"
                >
                  {animalitos.map(animal => (
                    <option key={animal.numero} value={animal.numero}>
                      {animal.numero} - {animal.nombre}
                    </option>
                  ))}
                </select>
              </div>

              <button
                onClick={agregarResultado}
                className="w-full bg-gradient-to-r from-purple-500 to-pink-600 text-white py-4 rounded-xl font-bold text-lg hover:from-purple-600 hover:to-pink-700 transition-all shadow-lg flex items-center justify-center gap-2"
              >
                <Save size={24} />
                Guardar Resultado
              </button>

              <div className="mt-6">
                <h3 className="text-lg font-bold text-gray-800 mb-3">√öltimos 10 Resultados Agregados</h3>
                <div className="space-y-2 max-h-64 overflow-y-auto">
                  {resultados.slice(-10).reverse().map(r => {
                    const animal = animalitos.find(a => a.numero === r.numero);
                    return (
                      <div key={r.id} className="bg-gray-50 rounded-lg p-3 flex items-center justify-between border border-gray-200">
                        <div className="flex items-center gap-3">
                          <div className={`${animal?.color} w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm`}>
                            {r.numero}
                          </div>
                          <div>
                            <p className="font-semibold text-gray-800">{animal?.nombre}</p>
                            <p className="text-xs text-gray-600">{r.fecha} - {r.horario} - {r.sorteo === 'lottoactivo' ? 'Lottoactivo' : 'La Granjita'}</p>
                          </div>
                        </div>
                        <button
                          onClick={() => eliminarResultado(r.id)}
                          className="text-red-500 hover:bg-red-50 p-2 rounded-lg transition-all"
                        >
                          <Trash2 size={20} />
                        </button>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          ) : vistaActual === 'resultados' ? (
            <div className="space-y-6">
              <div className="bg-gradient-to-br from-orange-50 to-pink-50 rounded-xl p-4 border-2 border-orange-200">
                <div className="flex items-center justify-center gap-2 mb-2">
                  <Calendar className="text-orange-600" size={24} />
                  <h3 className="text-lg font-bold text-gray-800">Resultados de Hoy</h3>
                </div>
                <p className="text-sm text-gray-600 text-center">
                  {new Date().toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                </p>
              </div>

              <div className="grid grid-cols-2 gap-3">
                <button
                  onClick={() => setSorteo('lottoactivo')}
                  className={`p-3 rounded-lg font-semibold transition-all ${
                    sorteo === 'lottoactivo'
                      ? 'bg-green-600 text-white shadow-lg'
                      : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                  }`}
                >
                  Lottoactivo
                </button>
                <button
                  onClick={() => setSorteo('granjita')}
                  className={`p-3 rounded-lg font-semibold transition-all ${
                    sorteo === 'granjita'
                      ? 'bg-blue-600 text-white shadow-lg'
                      : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                  }`}
                >
                  La Granjita
                </button>
              </div>

              <div className="space-y-3">
                {obtenerResultadosHoy().length > 0 ? (
                  obtenerResultadosHoy().map(resultado => {
                    const animal = animalitos.find(a => a.numero === resultado.numero);
                    return (
                      <div key={resultado.id} className="bg-gradient-to-r from-orange-50 to-white rounded-lg p-3 shadow-md border border-orange-200 flex items-center gap-3">
                        <div className="bg-orange-600 text-white px-3 py-2 rounded-lg font-bold text-sm min-w-[80px] text-center">
                          {resultado.horario}
                        </div>
                        <div className={`${animal?.color} w-12 h-12 rounded-full flex items-center justify-center text-white font-bold shadow-lg`}>
                          {resultado.numero}
                        </div>
                        <div className="flex-1">
                          <p className="font-bold text-gray-800 text-lg">{animal?.nombre}</p>
                          <p className="text-sm text-gray-600">N√∫mero {resultado.numero}</p>
                        </div>
                        <Trophy className="text-yellow-500" size={24} />
                      </div>
                    );
                  })
                ) : (
                  <div className="text-center py-8 text-gray-500">
                    <Clock size={48} className="mx-auto mb-2 opacity-50" />
                    <p>No hay resultados registrados para hoy en {sorteo === 'lottoactivo' ? 'Lottoactivo' : 'La Granjita'}</p>
                  </div>
                )}
              </div>
            </div>
          ) : (
            <div className="space-y-6">
              <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-5 border-2 border-blue-200">
                <div className="flex items-center justify-between mb-3">
                  <div className="flex items-center gap-2">
                    <BarChart3 className="text-blue-600" size={24} />
                    <h3 className="text-lg font-bold text-gray-800">Estad√≠sticas - {getPeriodoTexto()}</h3>
                  </div>
                  <select
                    value={periodoEstadistica}
                    onChange={(e) => setPeriodoEstadistica(e.target.value)}
                    className="p-2 border-2 border-blue-300 rounded-lg text-sm font-semibold"
                  >
                    <option value="dia">Hoy</option>
                    <option value="semana">√öltima Semana</option>
                    <option value="mes">√öltimo Mes</option>
                  </select>
                </div>
                <div className="text-center">
                  <p className="text-2xl font-bold text-blue-600">{obtenerResultadosFiltrados().length}</p>
                  <p className="text-sm text-gray-600">Sorteos Registrados</p>
                </div>
              </div>

              <div>
                <h3 className="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                  <TrendingUp className="text-green-600" size={20} />
                  Top 10 - M√°s Frecuentes
                </h3>
                <div className="space-y-2">
                  {getTopAnimalitos().map((animal, index) => (
                    <div
                      key={animal.numero}
                      className="bg-gradient-to-r from-green-50 to-white rounded-lg p-3 shadow-sm border border-green-200 flex items-center gap-3"
                    >
                      <span className="text-lg font-bold text-green-600 w-8">#{index + 1}</span>
                      <div className={`${animal.color} w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm shadow`}>
                        {animal.numero}
                      </div>
                      <div className="flex-1">
                        <p className="font-semibold text-gray-800">{animal.nombre}</p>
                        <p className="text-xs text-gray-500">{animal.porcentaje}% de probabilidad</p>
                      </div>
                      <div className="text-right">
                        <p className="text-xl font-bold text-green-600">{animal.veces}</p>
                        <p className="text-xs text-gray-500">veces</p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              <div>
                <h3 className="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                  <BarChart3 className="text-orange-600" size={20} />
                  Top 10 - Menos Frecuentes
                </h3>
                <div className="space-y-2">
                  {getMenosFrequentes().map((animal, index) => (
                    <div
                      key={animal.numero}
                      className="bg-gradient-to-r from-orange-50 to-white rounded-lg p-3 shadow-sm border border-orange-200 flex items-center gap-3"
                    >
                      <span className="text-lg font-bold text-orange-600 w-8">#{index + 1}</span>
                      <div className={`${animal.color} w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm shadow`}>
                        {animal.numero}
                      </div>
                      <div className="flex-1">
                        <p className="font-semibold text-gray-800">{animal.nombre}</p>
                        <p className="text-xs text-gray-500">{animal.porcentaje}% de probabilidad</p>
                      </div>
                      <div className="text-right">
                        <p className="text-xl font-bold text-orange-600">{animal.veces}</p>
                        <p className="text-xs text-gray-500">veces</p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}
        </div>

        <div className="bg-white/90 backdrop-blur rounded-xl p-4 text-sm text-gray-700">
          <p className="text-center">
            <strong>Nota:</strong> Los resultados y estad√≠sticas se basan en los datos que ingreses manualmente. 
            Las probabilidades se calculan sobre el per√≠odo seleccionado. Juega responsablemente.
          </p>
        </div>
      </div>
    </div>
  );
}
